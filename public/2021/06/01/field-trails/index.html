<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Field Trails | Johzzy Pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Field Trials 介绍field trials （试用特性）是Chrome 的一种特性开关机制，WebRTC沿用了它。其本质是一种特定格式的字符串，格式如下： &quot;FieldTrialName1&#x2F;Enabled&#x2F;FieldTrialName2&#x2F;Disabled&#x2F;FieldTrialName3&#x2F;Disabled&#x2F;&quot; 最简格式为空字符串&quot;&quot; 基本单元&amp;qu">
<meta property="og:type" content="article">
<meta property="og:title" content="Field Trails">
<meta property="og:url" content="https://johzzy.github.io/2021/06/01/field-trails/index.html">
<meta property="og:site_name" content="Johzzy Pages">
<meta property="og:description" content="Field Trials 介绍field trials （试用特性）是Chrome 的一种特性开关机制，WebRTC沿用了它。其本质是一种特定格式的字符串，格式如下： &quot;FieldTrialName1&#x2F;Enabled&#x2F;FieldTrialName2&#x2F;Disabled&#x2F;FieldTrialName3&#x2F;Disabled&#x2F;&quot; 最简格式为空字符串&quot;&quot; 基本单元&amp;qu">
<meta property="og:locale">
<meta property="article:published_time" content="2021-06-01T11:34:12.000Z">
<meta property="article:modified_time" content="2021-06-18T11:17:23.786Z">
<meta property="article:author" content="johzzy">
<meta property="article:tag" content="webrtc">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/public/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/public/" id="logo">Johzzy Pages</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/public/">Home</a>
        
          <a class="main-nav-link" href="/public/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://johzzy.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-field-trails" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/public/2021/06/01/field-trails/" class="article-date">
  <time datetime="2021-06-01T11:34:12.000Z" itemprop="datePublished">2021-06-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Field Trails
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Field-Trials-介绍"><a href="#Field-Trials-介绍" class="headerlink" title="Field Trials 介绍"></a>Field Trials 介绍</h2><p>field trials （试用特性）是Chrome 的一种特性开关机制，WebRTC沿用了它。其本质是一种特定格式的字符串，格式如下：</p>
<pre><code>&quot;FieldTrialName1/Enabled/FieldTrialName2/Disabled/FieldTrialName3/Disabled/&quot;
</code></pre><h3 id="最简格式为空字符串"><a href="#最简格式为空字符串" class="headerlink" title="最简格式为空字符串"></a>最简格式为空字符串</h3><pre><code>&quot;&quot;
</code></pre><h3 id="基本单元"><a href="#基本单元" class="headerlink" title="基本单元"></a>基本单元</h3><pre><code>&quot;FieldTrialName/FieldTrialValue/&quot;
</code></pre><h3 id="FieldTrialValue的有效值"><a href="#FieldTrialValue的有效值" class="headerlink" title="FieldTrialValue的有效值"></a>FieldTrialValue的有效值</h3><p>常见的FieldTrialValue取值有 Enabled 和 Disabled，一些例外的还有形如 Default，EnabledByFlag_2SL3TL，比如</p>
<pre><code>WebRTC-H264Simulcast/Enabled/
WebRTC-LegacySimulcastLayerLimit/Disabled/
WebRTC-SupportVP9SVC/Default/
WebRTC-SupportVP9SVC/EnabledByFlag_2SL3TL/
WebRTC-Vp9InterLayerPred/Enabled,inter_layer_pred_mode:off/
WebRTC-Vp9InterLayerPred/Enabled,inter_layer_pred_mode:on/
WebRTC-Vp9InterLayerPred/Enabled,inter_layer_pred_mode:onkeypic/
WebRTC-VP8-Forced-Fallback-Encoder-v2/Enabled-1,2,34567/
// 开启 Audio-NetEqExtraDelay 值为 120ms
WebRTC-Audio-NetEqExtraDelay/Enabled-120/
</code></pre><p>特殊例子中FieldTrialValue的具体含义取决于相应代码的解释，一般以Enabled开头</p>
<p>在chrome浏览器中，可以打开 chrome://flags 查看 FieldTrials</p>
<h2 id="WebRTC利用它完成了什么？"><a href="#WebRTC利用它完成了什么？" class="headerlink" title="WebRTC利用它完成了什么？"></a>WebRTC利用它完成了什么？</h2><pre><code>constexpr char kUseLegacySimulcastLayerLimitFieldTrial[] =
    &quot;WebRTC-LegacySimulcastLayerLimit&quot;;


if (!absl::StartsWith(trials.Lookup(kUseLegacySimulcastLayerLimitFieldTrial), &quot;Disabled&quot;)) &#123;
// Case A: kUseLegacySimulcastLayerLimitFieldTrial is Enabled
&#125; else &#123;
// Case B: kUseLegacySimulcastLayerLimitFieldTrial is Disabled
&#125;
</code></pre><p>当我们设置的 fieldtrials 中包含 “WebRTC-LegacySimulcastLayerLimit/Disabled” 则走到 Case B，包含 “WebRTC-LegacySimulcastLayerLimit/Enabled” 则走到 Case A。</p>
<p>思考：都不包含会走A还是B？</p>
<h2 id="FieldTrials-如何使用？"><a href="#FieldTrials-如何使用？" class="headerlink" title="FieldTrials 如何使用？"></a>FieldTrials 如何使用？</h2><pre><code>// c++ @see https://github.com/johzzy/webrtc-mirror/blob/master/system_wrappers/include/field_trial.h#L83
webrtc::field_trial::InitFieldTrialsFromString(const char* trials_string);
// 举例
webrtc::field_trial::InitFieldTrialsFromString(&quot;Audio/Enabled/Video/Disabled/&quot;);



// java @see https://github.com/johzzy/webrtc-mirror/blob/master/sdk/android/api/org/webrtc/PeerConnectionFactory.java#L99
public PeerConnectionFactory.InitializationOptions.Builder setFieldTrials(String fieldTrials)
// 举例
String fieldTrials = &quot;WebRTC-LegacySimulcastLayerLimit/Disabled/&quot;;
PeerConnectionFactory.initialize(
        PeerConnectionFactory.InitializationOptions.builder(context)
                .setFieldTrials(fieldTrials)
                .setEnableInternalTracer(true)
                .createInitializationOptions());
// oc @see https://github.com/johzzy/webrtc-mirror/blob/master/sdk/objc/api/peerconnection/RTCFieldTrials.h#L33
void RTCInitFieldTrialDictionary(NSDictionary&lt;NSString *, NSString *&gt; *fieldTrials) &#123;
if (!fieldTrials) &#123;
    RTCLogWarning(@&quot;No fieldTrials provided.&quot;);
    return;
&#125;
// Assemble the keys and values into the field trial string.
// We don&apos;t perform any extra format checking. That should be done by the underlying WebRTC calls.
NSMutableString *fieldTrialInitString = [NSMutableString string];
for (NSString *key in fieldTrials) &#123;
    NSString *fieldTrialEntry = [NSString stringWithFormat:@&quot;%@/%@/&quot;, key, fieldTrials[key]];
    [fieldTrialInitString appendString:fieldTrialEntry];
&#125;
size_t len = fieldTrialInitString.length + 1;
gFieldTrialInitString.reset(new char[len]);
if (![fieldTrialInitString getCString:gFieldTrialInitString.get()
                            maxLength:len
                            encoding:NSUTF8StringEncoding]) &#123;
    RTCLogError(@&quot;Failed to convert field trial string.&quot;);
    return;
&#125;
webrtc::field_trial::InitFieldTrialsFromString(gFieldTrialInitString.get());
&#125;


举例
NSDictionary *fieldTrials = @&#123;&#125;;
RTCInitFieldTrialDictionary(fieldTrials);


// 命令行
--force-fieldtrials=WebRTC-H264Simulcast/Enabled/
</code></pre><h2 id="FieldTrials-实现"><a href="#FieldTrials-实现" class="headerlink" title="FieldTrials 实现"></a>FieldTrials 实现</h2><pre><code>https://github.com/johzzy/webrtc-mirror/blob/master/system_wrappers/include/field_trial.h
https://github.com/johzzy/webrtc-mirror/blob/master/system_wrappers/source/field_trial_unittest.cc
</code></pre><h2 id="FieldTrials-应用示例"><a href="#FieldTrials-应用示例" class="headerlink" title="FieldTrials 应用示例"></a>FieldTrials 应用示例</h2><p>使用 WebRTC-PcFactoryDefaultBitrates 控制码率</p>
<pre><code>WebRTC-PcFactoryDefaultBitrates/Enabled,min:60,max:4000,start:600/
</code></pre><p>码率控制也可以通过sdp进行（相比FieldTrials，sdp设置的优先级更高）</p>
<pre><code>a=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;x-google-min-bitrate=400;x-google-max-bitrate=600;profile-level-id=42e01f
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://johzzy.github.io/2021/06/01/field-trails/" data-id="ckqhkhszs001cuavq2mcz54tr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/public/tags/webrtc/" rel="tag">webrtc</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/public/2021/06/16/simulcast/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Simulcast
        
      </div>
    </a>
  
  
    <a href="/public/2018/05/13/2018-05-13-ffmpeg-scale-samples/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">ffmpeg scale samples</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/public/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/C/" rel="tag">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/FTP/" rel="tag">FTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/Python/" rel="tag">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/ffmpeg/" rel="tag">ffmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/lambda/" rel="tag">lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/shell/" rel="tag">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/simulcast/" rel="tag">simulcast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/public/tags/webrtc/" rel="tag">webrtc</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2021/07/">July 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2021/06/">June 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/08/">August 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/06/">June 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2015/01/">January 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/public/archives/2014/02/">February 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/public/2021/07/23/how-to-add-custom-field-in-webrtc-sdp/">How to add custom field in WebRTC SDP</a>
          </li>
        
          <li>
            <a href="/public/2021/07/22/how-to-support-simulcast-in-srs/">How to support Simulcast in SRS</a>
          </li>
        
          <li>
            <a href="/public/2021/06/28/a-mac-bug-about-udp-port-triggered-by-srs/">a mac bug about udp port triggered by srs</a>
          </li>
        
          <li>
            <a href="/public/2021/06/23/simulcast-layer-state-control/">simulcast layer state control</a>
          </li>
        
          <li>
            <a href="/public/2021/06/18/simulcast-support-in-srs/">simulcast support in srs</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 johzzy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/public/" class="mobile-nav-link">Home</a>
  
    <a href="/public/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/public/fancybox/jquery.fancybox.css">

  
<script src="/public/fancybox/jquery.fancybox.pack.js"></script>




<script src="/public/js/script.js"></script>




  </div>
</body>
</html>